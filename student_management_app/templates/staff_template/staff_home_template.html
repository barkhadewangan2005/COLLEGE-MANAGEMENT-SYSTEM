{% extends 'base.html' %}
{% block page_title %}Staff Dashboard{% endblock %}
{% block main_content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-3 col-6">
            <div class="small-box bg-info">
                <div class="inner">
                    <h3>{{ students_count }}</h3>
                    <p>Total Students</p>
                </div>
                <div class="icon"><i class="fas fa-user-graduate"></i></div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-success">
                <div class="inner">
                    <h3>{{ subject_count }}</h3>
                    <p>My Subjects</p>
                </div>
                <div class="icon"><i class="fas fa-book"></i></div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-warning">
                <div class="inner">
                    <h3>{{ attendance_count }}</h3>
                    <p>Attendance Taken</p>
                </div>
                <div class="icon"><i class="fas fa-clipboard-check"></i></div>
            </div>
        </div>
        <div class="col-lg-3 col-6">
            <div class="small-box bg-danger">
                <div class="inner">
                    <h3>{{ leave_count }}</h3>
                    <p>Approved Leaves</p>
                </div>
                <div class="icon"><i class="fas fa-calendar-alt"></i></div>
            </div>
        </div>
    </div>
    <!-- Charts Row -->
    <div class="row">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header border-transparent">
                    <h3 class="card-title"><i class="fas fa-chart-pie"></i> Attendance Overview</h3>
                </div>
                <div class="card-body">
                    <canvas id="attendanceChart" style="height: 250px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header border-transparent">
                    <h3 class="card-title"><i class="fas fa-chart-line"></i> My Statistics</h3>
                </div>
                <div class="card-body">
                    <canvas id="statsChart" style="height: 250px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Welcome Card -->
    <div class="card card-success card-outline">
        <div class="card-header">
            <h3 class="card-title"><i class="fas fa-home"></i> Welcome to Staff Dashboard</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-tasks"></i> Quick Actions</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-chevron-right text-primary"></i> <a
                                href="{% url 'staff_take_attendance' %}">Take Attendance</a></li>
                        <li><i class="fas fa-chevron-right text-success"></i> <a href="{% url 'staff_add_result' %}">Add
                                Student Results</a></li>
                        <li><i class="fas fa-chevron-right text-warning"></i> <a
                                href="{% url 'staff_apply_leave' %}">Apply for Leave</a></li>
                        <li><i class="fas fa-chevron-right text-info"></i> <a href="{% url 'staff_feedback' %}">Send
                                Feedback</a></li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5><i class="fas fa-info-circle"></i> Your Overview</h5>
                    <p>Manage your classes efficiently from this dashboard.</p>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-check-circle text-success"></i> {{ students_count }} Students under your
                            subjects</li>
                        <li><i class="fas fa-check-circle text-success"></i> {{ subject_count }} Subjects assigned to
                            you</li>
                        <li><i class="fas fa-check-circle text-success"></i> {{ attendance_count }} Attendance records
                            taken</li>
                        <li><i class="fas fa-check-circle text-success"></i> {{ leave_count }} Approved leaves</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script>
    // Attendance Overview Chart
    var ctx1 = document.getElementById('attendanceChart').getContext('2d');
    var attendanceChart = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: {{ subject_list| safe }},
    datasets: [{
        label: 'Attendance Taken',
        data: {{ attendance_list| safe }},
        backgroundColor: 'rgba(75, 192, 192, 0.8)',
        borderColor: 'rgba(75, 192, 192, 1)',
        borderWidth: 1
            }]
        },
    options: {
        responsive: true,
            maintainAspectRatio: false,
                scales: {
            y: {
                beginAtZero: true,
                    ticks: { stepSize: 1 }
            }
        },
        plugins: {
            legend: { display: false },
            title: {
                display: true,
                    text: 'Attendance Count by Subject',
                        font: { size: 14 }
            }
        }
    }
    });

    // Statistics Chart
    var ctx2 = document.getElementById('statsChart').getContext('2d');
    var statsChart = new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['Approved Leaves', 'Pending Leaves', 'Rejected Leaves'],
            datasets: [{
                data: [{{ leave_count }}, {{ leave_pending }}, {{ leave_rejected }}],
    backgroundColor: [
        'rgba(40, 167, 69, 0.8)', // Success/Green
        'rgba(255, 193, 7, 0.8)', // Warning/Yellow
        'rgba(220, 53, 69, 0.8)'  // Danger/Red
    ],
        borderColor: [
            'rgba(40, 167, 69, 1)',
            'rgba(255, 193, 7, 1)',
            'rgba(220, 53, 69, 1)'
        ],
            borderWidth: 2
            }]
        },
    options: {
        responsive: true,
            maintainAspectRatio: false,
                plugins: {
            legend: {
                position: 'bottom',
                    labels: {
                    padding: 15,
                        font: { size: 12 }
                }
            },
            title: {
                display: true,
                    text: 'My Leave Statistics',
                        font: { size: 14 }
            }
        }
    }
    });
</script>

{% endblock %}